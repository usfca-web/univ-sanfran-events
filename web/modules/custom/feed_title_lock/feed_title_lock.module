<?php

use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_form_alter().
 *
 * Disable the Title field on Event node edit forms unless the user has
 * the 'administrator' role.
 */
function feed_title_lock_form_alter(array &$form, FormStateInterface $form_state, $form_id) {
  // Target the Event content type.
  $target_bundle = 'event';

  // Only apply to the EDIT form for Event nodes.
  $expected_form_id = "node_{$target_bundle}_edit_form";
  if ($form_id !== $expected_form_id) {
    return;
  }

  // Allow administrators to edit the title as normal.
  $account = \Drupal::currentUser();
  if ($account->hasRole('administrator')) {
    return;
  }

  // Disable the Title field but keep it visible for all non-admin users.
  if (isset($form['title']['widget'][0]['value']) && is_array($form['title']['widget'][0]['value'])) {
    $form['title']['widget'][0]['value']['#disabled'] = TRUE;
    $form['title']['widget'][0]['value']['#description'] = t('This title is managed automatically from an external feed.');
  }
  elseif (isset($form['title']) && is_array($form['title'])) {
    $form['title']['#disabled'] = TRUE;
    $form['title']['#description'] = t('This title is managed automatically from an external feed.');
  }
}